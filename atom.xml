<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title>Kaushikc.Org</title>
    <link href="https://kaushikc.org/atom.xml" rel="self" />
    <link href="https://kaushikc.org" />
    <id>https://kaushikc.org/atom.xml</id>
    <author>
        <name>Kaushik Chakraborty</name>
        <email>feed@kaushikc.org</email>
    </author>
    <updated>2020-04-10T00:00:00Z</updated>
    <entry>
    <title>Declarative, Decentralised, and Secure communication via Matrix, Jitsi, & NixOS</title>
    <link href="https://kaushikc.org/posts/matrix-jitsi-nixos.html" />
    <id>https://kaushikc.org/posts/matrix-jitsi-nixos.html</id>
    <published>2020-04-10T00:00:00Z</published>
    <updated>2020-04-10T00:00:00Z</updated>
    <summary type="html"><![CDATA[<article class="post">
    <h1>
        
        <a href="/posts/matrix-jitsi-nixos.html">
            Declarative, Decentralised, and Secure communication via Matrix, Jitsi, & NixOS
        </a>
        
        <a href="/posts/matrix-jitsi-nixos.html" class="link-perma">
            <span>&#9679</span>
        </a>
    </h1>
    <div class="byline">
    <p class="date">April 10, 2020</p>
    <p class="author"><a href="/tags/technology.html">technology</a>, <a href="/tags/nixos.html">nixos</a></p>
</div>
<div class="bodycopy">
    <p>It has been one of my strong pursuit to figure out a properly encrypted and decentralised communication setup. <a href="matrix.org">Matrix</a>’s claim to provide that is pretty strong against other alternatives. I’ve been using <a href="riot.im">Riot</a>, the most feature rich Matrix client, but mainly as an IRC bouncer.</p>
<p>Just the other day I read this awesome guide on <em><a href="https://matrix.org/blog/2020/04/06/running-your-own-secure-communication-service-with-matrix-and-jitsi">Running your own secure communication service with Matrix and Jitsi</a></em> and realised it’s not that difficult nowadays to setup all the pieces of the puzzle.</p>
<p>And so if I want to follow those steps shown in the above article but rather do it in NixOS - another project I am really excited about - how easy/difficult it would be ?</p>
<p>Well apart from minor tweaks, it was pretty straightforward and I would argue more simpler than how its done for a Debian based system. Following is the rundown of how I made the relevant steps work for my setup. I am not going to repeat all the nice technical explanations of above article. So anyone following <strong>should </strong>first read the above article.</p>
<p>Before we begin, I would also like to address one difference from the basic premise of the above article - Unlike in the above article the main domain (<em>dangerousdemos.net</em>) is already pointing to an existing blog <a href="https://help.github.com/en/github/working-with-github-pages/configuring-a-custom-domain-for-your-github-pages-site">hosted from a Github repository</a>. I think this might be a case for many like me who already have a domain name serving a static blog (like this one) but want to setup Matrix via the subdomains.</p>
<p>So lets begin,</p>
<h2 id="nixos">NixOS</h2>
<p>With NixOS every step is declarative and hence we don’t have to worry about the mechanical rigor as is the case with most of the steps in the original article. What it entails for us broadly are these 3 steps (<em>apart from some additional stuff</em>)</p>
<ul>
<li>Update <code>/etc/nixos/configuration.nix</code></li>
<li>Run <code>sudo nixos-rebuild switch</code></li>
<li>Done!</li>
</ul>
<p><a href="https://nixos.org/">NixOS</a> made following the original article really easy as I could make mistakes and not worry because I could rollback and start again. Let that sink in as I think that in itself is mind-blowing.</p>
<h2 id="dns">DNS</h2>
<p>Let’s use the same domain name - <em>dangerousdemos.net</em> - as used in the original article for our explanations. As mentioned above, we have one change here that the root domain already is redirecting to the static blog hosted in Github Pages. So we need to setup <code>A</code> records for the following subdomains:</p>
<ul>
<li><code>matrix.dangerousdemos.net</code> (for Synapse)</li>
<li><code>riot.dangerousdemos.net</code> (for Riot/Web)</li>
<li><code>jitsi.dangerousdemos.net</code> (for Jitsi)</li>
<li><em><code>turn.dangerousdemos.net</code></em> (for coturn based <code>TURN</code> server that in original article is taken care by <code>jitsi-meet</code> installer)</li>
</ul>
<p><em>Its important for all these to setup in the DNS before we run our configurations so that LetsEncrypt challenge flow works fine or else we might face errors.</em></p>
<h2 id="firewall">Firewall</h2>
<p>We need to ensure that following ports are open in the NixOS firewall for all the configurations to work fine</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"> <span class="co"># /etc/nixos/configuration.nix</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="ex">networking.firewall</span> = {</a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="ex">allowedUDPPorts</span> = [ 5349 5350]<span class="kw">;</span></a>
<a class="sourceLine" id="cb1-5" title="5">    <span class="ex">allowedTCPPorts</span> = [ 80 443 3478 3479]<span class="kw">;</span></a>
<a class="sourceLine" id="cb1-6" title="6">  }</a></code></pre></div>
<h2 id="nginx-with-letsencrypt">Nginx with LetsEncrypt</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co"># /etc/nixos/configuration.nix</span></a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5"> <span class="ex">services.nginx</span> = {</a>
<a class="sourceLine" id="cb2-6" title="6">   <span class="bu">enable</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb2-7" title="7">   <span class="ex">virtualHosts</span> = {</a>
<a class="sourceLine" id="cb2-8" title="8"></a>
<a class="sourceLine" id="cb2-9" title="9">     <span class="co">## virtual host for Syapse</span></a>
<a class="sourceLine" id="cb2-10" title="10">     <span class="st">&quot;matrix.dangerousdemos.net&quot;</span> = <span class="kw">{</span></a>
<a class="sourceLine" id="cb2-11" title="11">       <span class="co">## for force redirecting HTTP to HTTPS</span></a>
<a class="sourceLine" id="cb2-12" title="12">       <span class="ex">forceSSL</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb2-13" title="13">       <span class="co">## this setting takes care of all LetsEncrypt business</span></a>
<a class="sourceLine" id="cb2-14" title="14">       <span class="ex">enableACME</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb2-15" title="15">       <span class="ex">locations.</span><span class="st">&quot;/&quot;</span> = {</a>
<a class="sourceLine" id="cb2-16" title="16">         <span class="ex">proxyPass</span> = <span class="st">&quot;http://localhost:8008&quot;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb2-17" title="17">       <span class="kw">}</span>;</a>
<a class="sourceLine" id="cb2-18" title="18">     };</a>
<a class="sourceLine" id="cb2-19" title="19"></a>
<a class="sourceLine" id="cb2-20" title="20">     <span class="co">## virtual host for Riot/Web</span></a>
<a class="sourceLine" id="cb2-21" title="21">     <span class="st">&quot;riot.dangerousdemos.net&quot;</span> = <span class="kw">{</span></a>
<a class="sourceLine" id="cb2-22" title="22">       <span class="co">## for force redirecting HTTP to HTTPS</span></a>
<a class="sourceLine" id="cb2-23" title="23">       <span class="ex">forceSSL</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb2-24" title="24">       <span class="co">## this setting takes care of all LetsEncrypt business</span></a>
<a class="sourceLine" id="cb2-25" title="25">       <span class="ex">enableACME</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb2-26" title="26">       <span class="co">## root points to the riot-web package content, also configured via Nix</span></a>
<a class="sourceLine" id="cb2-27" title="27">       <span class="ex">locations.</span><span class="st">&quot;/&quot;</span> = {</a>
<a class="sourceLine" id="cb2-28" title="28">           <span class="ex">root</span> = pkgs.riot-web<span class="kw">;</span></a>
<a class="sourceLine" id="cb2-29" title="29">       <span class="kw">}</span>;</a>
<a class="sourceLine" id="cb2-30" title="30">     };</a>
<a class="sourceLine" id="cb2-31" title="31"></a>
<a class="sourceLine" id="cb2-32" title="32">     <span class="co">## virtual host for Jitsi, reusing the same hostname as used</span></a>
<a class="sourceLine" id="cb2-33" title="33">     <span class="co">## while configuring jitsi-meet</span></a>
<a class="sourceLine" id="cb2-34" title="34">     <span class="va">${config</span><span class="er">.services.jitsi</span><span class="va">-</span>meet.hostName<span class="va">}</span> = <span class="kw">{</span></a>
<a class="sourceLine" id="cb2-35" title="35">       <span class="ex">enableACME</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb2-36" title="36">       <span class="ex">forceSSL</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb2-37" title="37">     <span class="kw">}</span>;</a>
<a class="sourceLine" id="cb2-38" title="38">   };</a>
<a class="sourceLine" id="cb2-39" title="39"></a>
<a class="sourceLine" id="cb2-40" title="40">   <span class="co">## other nginx specific best practices</span></a>
<a class="sourceLine" id="cb2-41" title="41">   <span class="ex">recommendedGzipSettings</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb2-42" title="42">   <span class="ex">recommendedOptimisation</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb2-43" title="43">   <span class="ex">recommendedTlsSettings</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb2-44" title="44"> };</a></code></pre></div>
<p>The above setups Nginx along with LetsEncrypt. If it’s required (like in the original article) to setup main domain as a virtual host then make an additional entry inside <code>virtualHosts</code></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="st">&quot;dangerousdemos.net&quot;</span> = <span class="kw">{</span></a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="ex">forceSSL</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="ex">enableACME</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="ex">locations.</span><span class="st">&quot;/&quot;</span> = {</a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="ex">root</span> = <span class="st">&quot;/var/www/dangerousdemos.net&quot;</span></a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="kw">}</span></a>
<a class="sourceLine" id="cb3-8" title="8">}</a></code></pre></div>
<h2 id="synapse">Synapse</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"> <span class="co"># /etc/nixos/configuration.nix</span></a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="ex">services.matrix-synapse</span> = {</a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="bu">enable</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb4-5" title="5"></a>
<a class="sourceLine" id="cb4-6" title="6">    <span class="co">## domain for the Matrix IDs</span></a>
<a class="sourceLine" id="cb4-7" title="7">    <span class="ex">server_name</span> = <span class="st">&quot;dangerousdemos.net&quot;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb4-8" title="8"></a>
<a class="sourceLine" id="cb4-9" title="9">    <span class="co">## enable metrics collection</span></a>
<a class="sourceLine" id="cb4-10" title="10">    <span class="ex">enable_metrics</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb4-11" title="11"></a>
<a class="sourceLine" id="cb4-12" title="12">    <span class="co">## enable user registration</span></a>
<a class="sourceLine" id="cb4-13" title="13">    <span class="ex">enable_registration</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb4-14" title="14"></a>
<a class="sourceLine" id="cb4-15" title="15">    <span class="co">## Synapse guys recommend to use PostgreSQL over SQLite</span></a>
<a class="sourceLine" id="cb4-16" title="16">    <span class="ex">database_type</span> = <span class="st">&quot;psycopg2&quot;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb4-17" title="17"></a>
<a class="sourceLine" id="cb4-18" title="18">    <span class="co">## database setup clarified later</span></a>
<a class="sourceLine" id="cb4-19" title="19">    <span class="ex">database_args</span> = {</a>
<a class="sourceLine" id="cb4-20" title="20">      <span class="ex">password</span> = <span class="st">&quot;synapse&quot;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb4-21" title="21">    };</a>
<a class="sourceLine" id="cb4-22" title="22"></a>
<a class="sourceLine" id="cb4-23" title="23">    <span class="co">## default http listener which nginx will passthrough to</span></a>
<a class="sourceLine" id="cb4-24" title="24">    <span class="ex">listeners</span> = [</a>
<a class="sourceLine" id="cb4-25" title="25">      <span class="kw">{</span></a>
<a class="sourceLine" id="cb4-26" title="26">        <span class="ex">port</span> = 8008<span class="kw">;</span></a>
<a class="sourceLine" id="cb4-27" title="27">        <span class="ex">tls</span> = false<span class="kw">;</span></a>
<a class="sourceLine" id="cb4-28" title="28">        <span class="ex">resources</span> = [</a>
<a class="sourceLine" id="cb4-29" title="29">          <span class="kw">{</span></a>
<a class="sourceLine" id="cb4-30" title="30">            <span class="ex">compress</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb4-31" title="31">            <span class="ex">names</span> = [<span class="st">&quot;client&quot;</span> <span class="st">&quot;webclient&quot;</span> <span class="st">&quot;federation&quot;</span>]<span class="kw">;</span></a>
<a class="sourceLine" id="cb4-32" title="32">          <span class="kw">}</span></a>
<a class="sourceLine" id="cb4-33" title="33">        ];</a>
<a class="sourceLine" id="cb4-34" title="34">      <span class="kw">}</span></a>
<a class="sourceLine" id="cb4-35" title="35">    ];</a>
<a class="sourceLine" id="cb4-36" title="36"></a>
<a class="sourceLine" id="cb4-37" title="37">    <span class="co">## coturn based TURN server integration (TURN server setup mentioned later),</span></a>
<a class="sourceLine" id="cb4-38" title="38">    <span class="co">## shared secret generated while configuring coturn</span></a>
<a class="sourceLine" id="cb4-39" title="39">    <span class="co">## and reused here (power of Nix being a real programming language)</span></a>
<a class="sourceLine" id="cb4-40" title="40">    <span class="ex">turn_uris</span> = [</a>
<a class="sourceLine" id="cb4-41" title="41">      <span class="st">&quot;turn:turn.dangerousdemos.net:3478?transport=udp&quot;</span></a>
<a class="sourceLine" id="cb4-42" title="42">      <span class="st">&quot;turn:turn.dangerousdemos.net:3478?transport=tcp&quot;</span></a>
<a class="sourceLine" id="cb4-43" title="43">    ];</a>
<a class="sourceLine" id="cb4-44" title="44">    <span class="ex">turn_shared_secret</span> = config.services.coturn.static-auth-secret<span class="kw">;</span></a>
<a class="sourceLine" id="cb4-45" title="45">  };</a></code></pre></div>
<p>Unlike in the original article we will do <a href="https://github.com/matrix-org/synapse#using-postgresql">what’s recommended by Synapse team</a> and configure PostgreSQL. In the current NixOS configuration for <code>services.matrix-synapse</code> it might be configuring PostgreSQL automatically based on the <code>database_type</code> setting but that will change in the new versions of NixOS where PostgreSQL setups need to happen separately. Here’s how we will do it for Synapse</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1"> <span class="co"># /etc/nixos/configuration.nix</span></a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="ex">services.postgresql</span> = {</a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="bu">enable</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb5-5" title="5"></a>
<a class="sourceLine" id="cb5-6" title="6">    <span class="co">## postgresql user and db name remains in the</span></a>
<a class="sourceLine" id="cb5-7" title="7">    <span class="co">## service.matrix-synapse.database_args setting which</span></a>
<a class="sourceLine" id="cb5-8" title="8">    <span class="co">## by default is matrix-synapse</span></a>
<a class="sourceLine" id="cb5-9" title="9">    <span class="ex">initialScript</span> = pkgs.writeText <span class="st">&quot;synapse-init.sql&quot;</span> <span class="st">&#39;&#39;</span></a>
<a class="sourceLine" id="cb5-10" title="10">        <span class="ex">CREATE</span> ROLE <span class="st">&quot;matrix-synapse&quot;</span> WITH LOGIN PASSWORD <span class="st">&#39;synapse&#39;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb5-11" title="11">        <span class="ex">CREATE</span> DATABASE <span class="st">&quot;matrix-synapse&quot;</span> WITH OWNER <span class="st">&quot;matrix-synapse&quot;</span></a>
<a class="sourceLine" id="cb5-12" title="12">            <span class="ex">TEMPLATE</span> template0</a>
<a class="sourceLine" id="cb5-13" title="13">            <span class="ex">LC_COLLATE</span> = <span class="st">&quot;C&quot;</span></a>
<a class="sourceLine" id="cb5-14" title="14">            <span class="ex">LC_CTYPE</span> = <span class="st">&quot;C&quot;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb5-15" title="15">        <span class="st">&#39;&#39;</span>;</a>
<a class="sourceLine" id="cb5-16" title="16">  };</a></code></pre></div>
<p><strong>Federation setting</strong></p>
<p>Original article’s description for <a href="https://matrix.org/blog/2020/04/06/running-your-own-secure-communication-service-with-matrix-and-jitsi#synapse">how to configure so that Matrix could find one’s server is nice</a>. I am just leveraging that with one additional setting required when there is already a static blog running via Github Pages pointing to base domain:</p>
<ul>
<li><p>create a file having this path <code>.well-known/matrix/server</code> in the top level of the Github repository serving the static site having the following content</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb6-1" title="1"><span class="fu">{</span> <span class="dt">&quot;m.server&quot;</span><span class="fu">:</span> <span class="st">&quot;matrix.dangerousdemos.net:443&quot;</span> <span class="fu">}</span></a></code></pre></div></li>
<li><p>Github Pages via Jekyll exclude dotfiles/dotdirs from serving, so we need to explicitly include them by creating <code>_config.yml</code> at the top level of the Github repository having the following content</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode yaml"><code class="sourceCode yaml"><a class="sourceLine" id="cb7-1" title="1"><span class="fu">include:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;.well-known&quot;</span><span class="kw">]</span></a></code></pre></div></li>
</ul>
<h2 id="riotweb">Riot/Web</h2>
<p><code>riot-web</code> is a package already available within Nix packages which will take care of getting the right release package along with signature verification. So we can safely add the same to <code>systemPackages</code> like this</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1"> <span class="co"># /etc/nixos/configuration.nix</span></a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3">  <span class="ex">environment</span> = {</a>
<a class="sourceLine" id="cb8-4" title="4">    <span class="ex">systemPackages</span> = with pkgs<span class="kw">;</span><span class="bu"> [</span></a>
<a class="sourceLine" id="cb8-5" title="5">        riot-web</a>
<a class="sourceLine" id="cb8-6" title="6">    ];</a>
<a class="sourceLine" id="cb8-7" title="7">  };</a></code></pre></div>
<p>However, we need to let know Nix of the additional configuration required once riot-web is setup. That we could do via <em>overlays</em>. This is another advantage of declarative package management where we state in clear terms the state of our system which also help us revert in case unexpected happens.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" title="1"> <span class="co"># /etc/nixos/configuration.nix</span></a>
<a class="sourceLine" id="cb9-2" title="2"></a>
<a class="sourceLine" id="cb9-3" title="3">  <span class="ex">nixpkgs.overlays</span> = [</a>
<a class="sourceLine" id="cb9-4" title="4">    <span class="kw">(</span><span class="ex">self</span>: super: {</a>
<a class="sourceLine" id="cb9-5" title="5">        <span class="ex">riot-web</span> = super.riot-web.override {</a>
<a class="sourceLine" id="cb9-6" title="6">            <span class="ex">conf</span> = {</a>
<a class="sourceLine" id="cb9-7" title="7">                 <span class="ex">default_server_config</span> = {</a>
<a class="sourceLine" id="cb9-8" title="8">                    <span class="st">&quot;m.homeserver&quot;</span> = <span class="kw">{</span></a>
<a class="sourceLine" id="cb9-9" title="9">                        <span class="st">&quot;base_url&quot;</span> = <span class="st">&quot;https://matrix.dangerousdemos.net&quot;</span>;</a>
<a class="sourceLine" id="cb9-10" title="10">                        <span class="st">&quot;server_name&quot;</span> = <span class="st">&quot;dangerousdemos.net&quot;</span>;</a>
<a class="sourceLine" id="cb9-11" title="11">                    <span class="kw">}</span>;</a>
<a class="sourceLine" id="cb9-12" title="12">                    <span class="st">&quot;m.identity_server&quot;</span> = <span class="kw">{</span></a>
<a class="sourceLine" id="cb9-13" title="13">                        <span class="st">&quot;base_url&quot;</span> = <span class="st">&quot;https://vector.im&quot;</span>;</a>
<a class="sourceLine" id="cb9-14" title="14">                    <span class="kw">}</span>;</a>
<a class="sourceLine" id="cb9-15" title="15">                 };</a>
<a class="sourceLine" id="cb9-16" title="16"></a>
<a class="sourceLine" id="cb9-17" title="17">                 <span class="co">## jitsi will be setup later,</span></a>
<a class="sourceLine" id="cb9-18" title="18">                 <span class="co">## but we need to add to Riot configuration</span></a>
<a class="sourceLine" id="cb9-19" title="19">                 <span class="ex">jitsi.preferredDomain</span> = <span class="st">&quot;jitsi.dangerousdemos.net&quot;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb9-20" title="20">            };</a>
<a class="sourceLine" id="cb9-21" title="21">        };</a>
<a class="sourceLine" id="cb9-22" title="22">    }<span class="kw">)</span></a>
<a class="sourceLine" id="cb9-23" title="23">  ];</a></code></pre></div>
<h2 id="jitsi">Jitsi</h2>
<p>Finally we head towards our last leg of configurations - setting up <code>jitsi-meet</code>. Unfortunately, current master and stable channels of Nix packages lack <code>jitsi-meet</code> and other supporting packages required to setup Jitsi. However, it will change pretty soon thanks to the awesome work from user <a href="https://github.com/mmilata">mmilata</a> in this <a href="https://github.com/NixOS/nixpkgs/pull/82920">pull request</a>. It’s feature complete and might come as part of the next Nix release (20.03). However, we can already use the same via <a href="https://github.com/nix-community/NUR">NUR</a>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" title="1"> <span class="co"># /etc/nixos/configuration.nix</span></a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3">  <span class="ex">imports</span> =</a>
<a class="sourceLine" id="cb10-4" title="4">    <span class="bu">let</span></a>
<a class="sourceLine" id="cb10-5" title="5">      <span class="ex">nur-no-pkgs</span> =</a>
<a class="sourceLine" id="cb10-6" title="6">        <span class="ex">import</span> (</a>
<a class="sourceLine" id="cb10-7" title="7">          <span class="ex">builtins.fetchTarball</span></a>
<a class="sourceLine" id="cb10-8" title="8">          <span class="st">&quot;https://github.com/nix-community/NUR/archive/master.tar.gz&quot;</span></a>
<a class="sourceLine" id="cb10-9" title="9">        ) {};</a>
<a class="sourceLine" id="cb10-10" title="10">    <span class="kw">in</span></a>
<a class="sourceLine" id="cb10-11" title="11">      [</a>
<a class="sourceLine" id="cb10-12" title="12">        <span class="ex">nur-no-pkgs.repos.mmilata.modules.jitsi-meet</span></a>
<a class="sourceLine" id="cb10-13" title="13">      ];</a></code></pre></div>
<p>The above import add only the new service to setup <code>jitsi-meet</code> without any other OS specific stuff. And the configuration for the new service would auto-magically setup the related software (like <code>videobridge</code> &amp; <code>jicofo</code>) to have a functioning Jitsi. We can then add a new virtual host to the Nginx configuration with the Jitsi <code>hostName</code> mentioned below (shown above in Nginx Section)</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" title="1"> <span class="co"># /etc/nixos/configuration.nix</span></a>
<a class="sourceLine" id="cb11-2" title="2"></a>
<a class="sourceLine" id="cb11-3" title="3">  <span class="ex">services.jitsi-meet</span> = {</a>
<a class="sourceLine" id="cb11-4" title="4">    <span class="bu">enable</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb11-5" title="5">    <span class="ex">hostName</span> = <span class="st">&quot;jitsi.dangerousdemos.net&quot;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb11-6" title="6"></a>
<a class="sourceLine" id="cb11-7" title="7">    <span class="co">## this setting is going to add relevant ports to</span></a>
<a class="sourceLine" id="cb11-8" title="8">    <span class="co">## networking.firewall.allowedTCPPorts &amp;</span></a>
<a class="sourceLine" id="cb11-9" title="9">    <span class="co">## networking.firewall.allowedUDPPorts</span></a>
<a class="sourceLine" id="cb11-10" title="10">    <span class="ex">videobridge.openFirewall</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb11-11" title="11">  };</a></code></pre></div>
<h2 id="turn-server">TURN server</h2>
<p><code>jitsi-meet</code> Debian package takes care of setting up TURN server but in our case we need to take care of it ourselves. I followed the instructions mentioned in <a href="https://github.com/matrix-org/synapse/blob/master/docs/turn-howto.md">this documentation</a>. Nix already has a service configuration to setup <code>coturn</code>. Once set up, we will integrate the relevant parts to Synapse (which we have already done above).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" title="1"> <span class="co"># /etc/nixos/configuration.nix</span></a>
<a class="sourceLine" id="cb12-2" title="2"></a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="ex">services.coturn</span> = {</a>
<a class="sourceLine" id="cb12-4" title="4">    <span class="bu">enable</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb12-5" title="5">    <span class="ex">use-auth-secret</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb12-6" title="6">    <span class="ex">static-auth-secret</span> = <span class="st">&quot;XJmzTf6VixzX5pDZKHOxtiUenkKzr10tlhBWYoti5DvCxR4TM9XlRHxII3Ml6yV2&quot;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb12-7" title="7">    <span class="ex">realm</span> = <span class="st">&quot;turn.dangerousdemos.net&quot;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb12-8" title="8">    <span class="ex">no-tcp-relay</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb12-9" title="9">    <span class="ex">no-tls</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb12-10" title="10">    <span class="ex">no-dtls</span> = true<span class="kw">;</span></a>
<a class="sourceLine" id="cb12-11" title="11">    <span class="ex">extraConfig</span> = <span class="st">&#39;&#39;</span></a>
<a class="sourceLine" id="cb12-12" title="12">        <span class="ex">user-quota</span>=12</a>
<a class="sourceLine" id="cb12-13" title="13">        <span class="ex">total-quota</span>=1200</a>
<a class="sourceLine" id="cb12-14" title="14">        <span class="ex">denied-peer-ip</span>=10.0.0.0-10.255.255.255</a>
<a class="sourceLine" id="cb12-15" title="15">        <span class="ex">denied-peer-ip</span>=192.168.0.0-192.168.255.255</a>
<a class="sourceLine" id="cb12-16" title="16">        <span class="ex">denied-peer-ip</span>=172.16.0.0-172.31.255.255</a>
<a class="sourceLine" id="cb12-17" title="17"></a>
<a class="sourceLine" id="cb12-18" title="18">        <span class="ex">allowed-peer-ip</span>=192.168.191.127</a>
<a class="sourceLine" id="cb12-19" title="19">    <span class="st">&#39;&#39;</span>;</a>
<a class="sourceLine" id="cb12-20" title="20">  };</a></code></pre></div>
<p><code>static-auth-secret</code> generated above is via the tool <code>pwgen</code> which in Nix we could do like this</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" title="1">$ <span class="ex">nix-shell</span> -p pwgen --command <span class="st">&quot;pwgen -s 64 1&quot;</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="ex">XJmzTf6VixzX5pDZKHOxtiUenkKzr10tlhBWYoti5DvCxR4TM9XlRHxII3Ml6yV2</span></a></code></pre></div>
<h2 id="conclusion">Conclusion</h2>
<p>Once we have <a href="https://gist.github.com/kaychaks/c1a79aef68c32818dec7540412c9ee4b">all the above configuration in place</a>, now is the time to finally run them all. This will take time to get all the necessary stuff downloaded and setup.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" title="1">$ <span class="fu">sudo</span> nixos-rebuild switch</a></code></pre></div>
<p>However, once its done you can launch Riot/Web, register a new user, create a room with someone else from the same MatrixVerse, have end-to-end encrypted conversation, and also start having a video call via Jitsi. All that infrastructure now being 100% owned by you with a protocol enforcing privacy and decentralisation. And finally every piece here is fully open-source.</p>
<p>In these times of covert and overt surveillance its imperative to take matters at your hand. And when right tools make it simple to set them up and easy to reason their behavior, it’s a nice feeling.</p>
</div>

</article>
]]></summary>
</entry>
<entry>
    <title>Logical equivalences in Haskell</title>
    <link href="https://kaushikc.org/posts/logical-equivalences-in-haskell.html" />
    <id>https://kaushikc.org/posts/logical-equivalences-in-haskell.html</id>
    <published>2019-01-03T00:00:00Z</published>
    <updated>2019-01-03T00:00:00Z</updated>
    <summary type="html"><![CDATA[<article class="post">
    <h1>
        
        <a href="/posts/logical-equivalences-in-haskell.html">
            Logical equivalences in Haskell
        </a>
        
        <a href="/posts/logical-equivalences-in-haskell.html" class="link-perma">
            <span>&#9679</span>
        </a>
    </h1>
    <div class="byline">
    <p class="date">January  3, 2019</p>
    <p class="author"><a href="/tags/technology.html">technology</a>, <a href="/tags/haskell.html">haskell</a></p>
</div>
<div class="bodycopy">
    <p>The blogpost <a href="https://cvlad.info/clasical-logic-in-haskell/">Classical Logic in Haskell</a> established a way to prove equivalences between logical propositions and <em>law of excluded middle</em> by writing intances of <code>Iso</code> for the same propositions wrapped in a <code>newtype</code>. <a href="https://twitter.com/cvlad">Vladimir’s</a> post contain proofs of some important propositions. I had fun proving them myself. I wanted to continue with some more.</p>
<p>Recently, I did the <a href="https://leanprover.github.io/logic_and_proof/">Logic and Proof</a> course to learn both proof techniques and <a href="https://leanprover.github.io/">Lean</a> theorem prover. It was fun. So I picked few propositions from the exercises of the <a href="https://leanprover.github.io/logic_and_proof/propositional_logic_in_lean.html#exercises">Propositional Logic in Lean</a> chapter to try write equivalence proofs for them.</p>
<p>Below are the propositions as newtypes (their logical notations mentioned as comment) and subsequently the <code>Iso</code> instances to prove their equivalences with <code>Lem</code>. As mentioned in the original blogpost, one nice way to progress here is by taking clues from the type system itself in the form of <a href="https://wiki.haskell.org/GHC/Typed_holes">typed holes</a>.</p>
<p>Let’s set some language pragmas</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" title="1"><span class="fu">:</span>set <span class="fu">-</span><span class="dt">XMultiParamTypeClasses</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="fu">:</span>set <span class="fu">-</span><span class="dt">XRankNTypes</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="fu">:</span>set <span class="fu">-</span><span class="dt">XInstanceSigs</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="fu">:</span>set <span class="fu">-</span><span class="dt">XScopedTypeVariables</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="fu">:</span>set <span class="fu">-</span><span class="dt">XTupleSections</span></a></code></pre></div>
<p>Required <code>Iso</code> class from the original blogpost put inside a module so that it can be imported for rest of the sections</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">module</span> <span class="dt">Proof</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">import</span> <span class="dt">Data.Void</span> (<span class="dt">Void</span>, absurd)</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw">class</span> <span class="dt">Iso</span> a b <span class="kw">where</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="ot">    to ::</span> a <span class="ot">-&gt;</span> b</a>
<a class="sourceLine" id="cb2-6" title="6"><span class="ot">    from ::</span> b <span class="ot">-&gt;</span> a</a>
<a class="sourceLine" id="cb2-7" title="7">    </a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">-- Law of excluded middle</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co">-- forall P. P \/ -P</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="kw">newtype</span> <span class="dt">Lem</span> m <span class="fu">=</span> </a>
<a class="sourceLine" id="cb2-11" title="11">    <span class="dt">Lem</span></a>
<a class="sourceLine" id="cb2-12" title="12">        (<span class="kw">forall</span> a <span class="fu">.</span></a>
<a class="sourceLine" id="cb2-13" title="13">            m (<span class="dt">Either</span> a (a <span class="ot">-&gt;</span> m <span class="dt">Void</span>)))    </a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">import</span> <span class="dt">Data.Void</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">import</span> <span class="dt">Proof</span></a></code></pre></div>
<p>And now the propositions…</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" title="1"><span class="co">-- forall. P,Q. P /\ (P -&gt; Q) -&gt; Q</span></a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="kw">import</span> <span class="dt">Control.Monad.Fix</span></a>
<a class="sourceLine" id="cb4-4" title="4"></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="kw">newtype</span> <span class="dt">Prop1</span> m <span class="fu">=</span> </a>
<a class="sourceLine" id="cb4-6" title="6">    <span class="dt">Prop1</span> </a>
<a class="sourceLine" id="cb4-7" title="7">        (<span class="kw">forall</span> a b<span class="fu">.</span> </a>
<a class="sourceLine" id="cb4-8" title="8">            (a , (a <span class="ot">-&gt;</span> m b)) <span class="ot">-&gt;</span> m b)</a>
<a class="sourceLine" id="cb4-9" title="9">            </a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">-- proof, implication elimination &lt;==&gt; LEM</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="kw">instance</span> <span class="dt">Monad</span> m <span class="ot">=&gt;</span> <span class="dt">Proof.Iso</span> (<span class="dt">Prop1</span> m) (<span class="dt">Lem</span> m) <span class="kw">where</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="ot">    from ::</span> <span class="dt">Lem</span> m <span class="ot">-&gt;</span> <span class="dt">Prop1</span> m</a>
<a class="sourceLine" id="cb4-13" title="13">    from _ <span class="fu">=</span> <span class="dt">Prop1</span> <span class="fu">$</span> <span class="fu">uncurry</span> (<span class="fu">flip</span> <span class="fu">id</span>)</a>
<a class="sourceLine" id="cb4-14" title="14">            </a>
<a class="sourceLine" id="cb4-15" title="15"><span class="ot">    to ::</span> <span class="dt">Prop1</span> m <span class="ot">-&gt;</span> <span class="dt">Lem</span> m</a>
<a class="sourceLine" id="cb4-16" title="16">    to (<span class="dt">Prop1</span> i) <span class="fu">=</span> <span class="dt">Lem</span> <span class="fu">$</span> <span class="fu">fmap</span> <span class="dt">Left</span> <span class="fu">$</span> i (<span class="fu">id</span>, <span class="fu">pure</span> <span class="fu">.</span> fix)</a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" title="1"><span class="co">-- forall. P,Q. P -&gt; - (- P /\ B)</span></a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="kw">newtype</span> <span class="dt">Prop2</span> m <span class="fu">=</span> </a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="dt">Prop2</span></a>
<a class="sourceLine" id="cb5-5" title="5">        (<span class="kw">forall</span> a b<span class="fu">.</span></a>
<a class="sourceLine" id="cb5-6" title="6">            (a <span class="ot">-&gt;</span> m (((a <span class="ot">-&gt;</span> m <span class="dt">Void</span>), b) <span class="ot">-&gt;</span> m <span class="dt">Void</span>)))</a>
<a class="sourceLine" id="cb5-7" title="7">            </a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">-- proof, Prop2 &lt;==&gt; LEM</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="kw">instance</span> <span class="dt">Monad</span> m <span class="ot">=&gt;</span> <span class="dt">Proof.Iso</span> (<span class="dt">Prop2</span> m) (<span class="dt">Lem</span> m) <span class="kw">where</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="ot">    to ::</span> <span class="dt">Prop2</span> m <span class="ot">-&gt;</span> <span class="dt">Lem</span> m</a>
<a class="sourceLine" id="cb5-11" title="11">    to (<span class="dt">Prop2</span> p) <span class="fu">=</span> <span class="dt">Lem</span> <span class="fu">$</span> <span class="fu">pure</span> <span class="fu">$</span> <span class="dt">Right</span> proof <span class="kw">where</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="ot">        proof ::</span> a <span class="ot">-&gt;</span> m <span class="dt">Void</span></a>
<a class="sourceLine" id="cb5-13" title="13">        proof x <span class="fu">=</span> p x <span class="fu">&gt;&gt;=</span> (<span class="fu">$</span> (proof, x))</a>
<a class="sourceLine" id="cb5-14" title="14">    </a>
<a class="sourceLine" id="cb5-15" title="15"><span class="ot">    from ::</span> <span class="dt">Lem</span> m <span class="ot">-&gt;</span> <span class="dt">Prop2</span> m</a>
<a class="sourceLine" id="cb5-16" title="16">    from (<span class="dt">Lem</span> l) <span class="fu">=</span> <span class="dt">Prop2</span> <span class="fu">$</span> <span class="fu">flip</span> <span class="fu">fmap</span> l <span class="fu">.</span> proof <span class="kw">where</span></a>
<a class="sourceLine" id="cb5-17" title="17"><span class="ot">        proof ::</span> a <span class="ot">-&gt;</span> <span class="dt">Either</span> a (a <span class="ot">-&gt;</span> m <span class="dt">Void</span>) <span class="ot">-&gt;</span> (((a <span class="ot">-&gt;</span> m <span class="dt">Void</span>), b) <span class="ot">-&gt;</span> m <span class="dt">Void</span>)</a>
<a class="sourceLine" id="cb5-18" title="18">        proof x <span class="fu">=</span> <span class="fu">either</span> (<span class="fu">flip</span> <span class="fu">fst</span>) (\f _ <span class="ot">-&gt;</span> f x)</a>
<a class="sourceLine" id="cb5-19" title="19">        </a></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" title="1"><span class="co">-- forall. P,Q. - (P /\ Q) -&gt; (P -&gt; - Q)</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">import</span> <span class="dt">Control.Applicative</span> (liftA2)</a>
<a class="sourceLine" id="cb6-3" title="3"></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="kw">newtype</span> <span class="dt">Prop3</span> m <span class="fu">=</span> </a>
<a class="sourceLine" id="cb6-5" title="5">    <span class="dt">Prop3</span></a>
<a class="sourceLine" id="cb6-6" title="6">        (<span class="kw">forall</span> a b<span class="fu">.</span></a>
<a class="sourceLine" id="cb6-7" title="7">            ((a,b) <span class="ot">-&gt;</span> m <span class="dt">Void</span>) <span class="ot">-&gt;</span> m (a <span class="ot">-&gt;</span> m (b <span class="ot">-&gt;</span> m <span class="dt">Void</span>)))</a>
<a class="sourceLine" id="cb6-8" title="8">            </a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">-- proof, Prop3 &lt;==&gt; LEM</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="kw">instance</span> <span class="dt">Monad</span> m <span class="ot">=&gt;</span> <span class="dt">Proof.Iso</span> (<span class="dt">Prop3</span> m) (<span class="dt">Lem</span> m) <span class="kw">where</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="ot">    to ::</span> <span class="dt">Prop3</span> m <span class="ot">-&gt;</span> <span class="dt">Lem</span> m</a>
<a class="sourceLine" id="cb6-12" title="12">    to (<span class="dt">Prop3</span> p) <span class="fu">=</span> <span class="dt">Lem</span> </a>
<a class="sourceLine" id="cb6-13" title="13">                    <span class="fu">$</span> <span class="fu">fmap</span> <span class="dt">Right</span> </a>
<a class="sourceLine" id="cb6-14" title="14">                    <span class="fu">$</span> proof </a>
<a class="sourceLine" id="cb6-15" title="15">                        <span class="fu">&gt;&gt;=</span> </a>
<a class="sourceLine" id="cb6-16" title="16">                        (\f <span class="ot">-&gt;</span> <span class="fu">pure</span> (liftA2 (<span class="fu">&gt;&gt;=</span>) f (<span class="fu">flip</span> <span class="fu">id</span>))) </a>
<a class="sourceLine" id="cb6-17" title="17">                <span class="kw">where</span></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="ot">                proof ::</span> m (a <span class="ot">-&gt;</span> m (a <span class="ot">-&gt;</span> m <span class="dt">Void</span>))</a>
<a class="sourceLine" id="cb6-19" title="19">                proof <span class="fu">=</span> p (\(x,y) <span class="ot">-&gt;</span> proof <span class="fu">&gt;&gt;=</span> ((<span class="fu">$</span> y) <span class="fu">=&lt;&lt;</span>) <span class="fu">.</span> (<span class="fu">$</span> x))</a>
<a class="sourceLine" id="cb6-20" title="20">        </a>
<a class="sourceLine" id="cb6-21" title="21"><span class="ot">    from ::</span> <span class="dt">Lem</span> m <span class="ot">-&gt;</span> <span class="dt">Prop3</span> m</a>
<a class="sourceLine" id="cb6-22" title="22">    from (<span class="dt">Lem</span> l) <span class="fu">=</span> <span class="dt">Prop3</span></a>
<a class="sourceLine" id="cb6-23" title="23">                    <span class="fu">$</span> (\f <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-24" title="24">                            <span class="fu">pure</span></a>
<a class="sourceLine" id="cb6-25" title="25">                                <span class="fu">$</span> \a <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-26" title="26">                                    <span class="fu">either</span> (<span class="fu">const</span> <span class="fu">.</span> f <span class="fu">.</span> (a ,)) <span class="fu">id</span> <span class="fu">&lt;$&gt;</span> l)</a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" title="1"><span class="co">-- forall. P,Q. -P /\ -Q -&gt; - (P \/ Q)</span></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">newtype</span> <span class="dt">Prop4</span> m <span class="fu">=</span> </a>
<a class="sourceLine" id="cb7-4" title="4">    <span class="dt">Prop4</span></a>
<a class="sourceLine" id="cb7-5" title="5">        (<span class="kw">forall</span> a b<span class="fu">.</span></a>
<a class="sourceLine" id="cb7-6" title="6">            ((a <span class="ot">-&gt;</span> m <span class="dt">Void</span> , b <span class="ot">-&gt;</span> m <span class="dt">Void</span>) <span class="ot">-&gt;</span> m (<span class="dt">Either</span> a b <span class="ot">-&gt;</span>  m <span class="dt">Void</span>)))</a>
<a class="sourceLine" id="cb7-7" title="7">            </a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">-- proof, Prop4 &lt;==&gt; LEM</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="kw">instance</span> <span class="dt">Monad</span> m <span class="ot">=&gt;</span> <span class="dt">Proof.Iso</span> (<span class="dt">Prop4</span> m) (<span class="dt">Lem</span> m) <span class="kw">where</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="ot">    to ::</span> <span class="dt">Prop4</span> m <span class="ot">-&gt;</span> <span class="dt">Lem</span> m</a>
<a class="sourceLine" id="cb7-11" title="11">    to (<span class="dt">Prop4</span> p) <span class="fu">=</span> <span class="dt">Lem</span> </a>
<a class="sourceLine" id="cb7-12" title="12">                    <span class="fu">$</span> <span class="fu">pure</span> </a>
<a class="sourceLine" id="cb7-13" title="13">                    <span class="fu">$</span> <span class="dt">Right</span> </a>
<a class="sourceLine" id="cb7-14" title="14">                        ((proof <span class="fu">&gt;&gt;=</span>) <span class="fu">.</span> <span class="fu">flip</span> <span class="fu">id</span> <span class="fu">.</span> <span class="dt">Left</span>)</a>
<a class="sourceLine" id="cb7-15" title="15">                <span class="kw">where</span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="ot">                proof ::</span> m (<span class="dt">Either</span> a a <span class="ot">-&gt;</span> m <span class="dt">Void</span>)</a>
<a class="sourceLine" id="cb7-17" title="17">                proof <span class="fu">=</span> <span class="fu">curry</span> p ((proof <span class="fu">&gt;&gt;=</span>)</a>
<a class="sourceLine" id="cb7-18" title="18">                                <span class="fu">.</span> <span class="fu">flip</span> <span class="fu">id</span></a>
<a class="sourceLine" id="cb7-19" title="19">                                <span class="fu">.</span> <span class="dt">Left</span>) </a>
<a class="sourceLine" id="cb7-20" title="20">                                ((proof <span class="fu">&gt;&gt;=</span>)</a>
<a class="sourceLine" id="cb7-21" title="21">                                <span class="fu">.</span> <span class="fu">flip</span> <span class="fu">id</span></a>
<a class="sourceLine" id="cb7-22" title="22">                                <span class="fu">.</span> <span class="dt">Right</span>)</a>
<a class="sourceLine" id="cb7-23" title="23">        </a>
<a class="sourceLine" id="cb7-24" title="24"><span class="ot">    from ::</span> <span class="dt">Lem</span> m <span class="ot">-&gt;</span> <span class="dt">Prop4</span> m</a>
<a class="sourceLine" id="cb7-25" title="25">    from _ <span class="fu">=</span> <span class="dt">Prop4</span> <span class="fu">$</span> <span class="fu">uncurry</span> <span class="fu">$</span> (<span class="fu">pure</span> <span class="fu">.</span>) <span class="fu">.</span> <span class="fu">either</span></a></code></pre></div>
<hr />
<p><em>This is an <a href="https://github.com/kaychaks/notebooks/blob/master/logical-equivalences-in-haskell.ipynb">IHaskell Notebook</a> which is pretty cool for above kind of experiments. Much more feature rich than GHCi. I got the inspiration from <a href="https://twitter.com/vbhvsgr">Vaibhav Sagar</a> who writes <a href="https://vaibhavsagar.com/">all his posts</a> as IHaskell Notebooks.</em></p>
</div>

</article>
]]></summary>
</entry>
<entry>
    <title>Retrospecting 2018</title>
    <link href="https://kaushikc.org/posts/retro-2018.html" />
    <id>https://kaushikc.org/posts/retro-2018.html</id>
    <published>2018-12-26T00:00:00Z</published>
    <updated>2018-12-26T00:00:00Z</updated>
    <summary type="html"><![CDATA[<article class="post">
    <h1>
        
        <a href="/posts/retro-2018.html">
            Retrospecting 2018
        </a>
        
        <a href="/posts/retro-2018.html" class="link-perma">
            <span>&#9679</span>
        </a>
    </h1>
    <div class="byline">
    <p class="date">December 26, 2018</p>
    <p class="author"><a href="/tags/technology.html">technology</a></p>
</div>
<div class="bodycopy">
    <p>This year was mostly uneventful unlike 2017. However, I did do a lot more technical reading - mostly papers and a few books - than previous years. Professionally things changed quite drastically. I am now meant to do mostly research-y things than what used to be half &amp; half with engineering before. Not that I complain, my feelings are on the contrary actually. But this whole new setting at work, both from an operations &amp; vision standpoint, is still clumsy and need more time to shape up well.</p>
<p>I am beginning to focus on the areas of <em>Knowledge Engineering</em>. I want to tie it with fascinating things from <em>Type Systems</em>. I believe their shared foundations in <em>Mathematical Logic</em> will provide interesting things to work on. And my choice of technology to realise any such research will be <em>Haskell</em>, mostly.</p>
<p>So apart from spending most of the time reading papers on the history of knowledge bases, their representation, and reasoning I also tried to get used to logic and proofs. During one such excavation, I landed on a course aptly named <a href="https://leanprover.github.io/logic_and_proof/">Logic and Proof</a> which uses this beautiful language called <a href="https://leanprover.github.io/">Lean</a> to write the proofs. Lean, like Haskell, has its roots in Microsoft Research. It, like Agda, is dependently typed language which also provides means to do inductive/automated theorem proving. It was my first foray into the world of computational theorem proving and some serious work with dependent types (I did dabble with Idris but it is better not to talk about that). Working with Lean and learning more about its origins and background type systems research gave me ideas that I believe are relevant to knowledge systems.</p>
<p>With Lean, I digressed heavily into learning dependent types, this time with a larger vision to make them useful for knowledge systems. And hence I got this amazing book called <a href="https://mitpress.mit.edu/books/little-typer"><em>The Little Typer</em></a>. It provides the necessary foundations for me to relate dependent types, higher-order logic, relational programming, and eventually their role in knowledge systems. I am nowhere close to anything concrete to go after but I am having fun peeling the layers of these seemingly disjoint fields converging together elegantly.</p>
<p>Haskell with its dependent typing tools is nowhere close to things that Lean and Agda could do today. But it’s still amazing how far the current type system could take you. <a href="https://leanpub.com/thinking-with-types">Sandy Maguire’s new book</a> is how I am trying to get my head around all those esoteric corners of Haskell. It’s pretty good.</p>
<p>I also want to mention one other thing that is happening coincidentally and maybe right now I am not able to leverage it to its full extent only coz of my lack of understanding but I am pretty sure it will be something that I will be leaning a lot in future. And that is <a href="https://www.twitch.tv/ekmett/videos?filter=all&amp;sort=time">Edward Kmett’s Twitch videos on his creation of Guanxi</a>. Ed’s videos are highly motivational (for some apparent indescribable reason).</p>
<p>Finally, I also want to highlight that I continued persevering with <em>Nix</em> irrespective of it still not friendly as a package manager in macOS. I realised that there’s no other way, right now, to reading <a href="https://github.com/NixOS/nixpkgs/">nixpkgs</a> source code to make stuff work properly with Nix especially in macOS. Hopefully, it will improve and I will also do my best towards that goal. But <em>Nix</em> is the future of so-called <em>devops</em> that I believe in and I want it to succeed at all costs.</p>
<p>As <a href="https://twitter.com/aarohi_c">my daughter</a> grows up to her 3rd year of existence in 2019, I am hoping her to be a bit more independent and me getting a bit more time off work to try to contribute to some open source Haskell projects. Having a 2-year-old kid around when you are trying to do some focussed programming session is not a happy setting (no offence to any 2-year-olds).</p>
<p>I learnt a lot of new things in 2018 that now I think I have some roadmap for next year to channel my energies on. But none of them is related to <em>Deep Learning</em>, <em>Blockchain</em>, or <em>Microservices</em> unfortunately !!</p>
</div>

</article>
]]></summary>
</entry>
<entry>
    <title>WC 2018: Final Day: Game of the champions</title>
    <link href="https://kaushikc.org/posts/wc-2018-day-25-game-of-champions.html" />
    <id>https://kaushikc.org/posts/wc-2018-day-25-game-of-champions.html</id>
    <published>2018-07-16T00:00:00Z</published>
    <updated>2018-07-16T00:00:00Z</updated>
    <summary type="html"><![CDATA[<article class="post">
    <h1>
        
        <a href="/posts/wc-2018-day-25-game-of-champions.html">
            WC 2018: Final Day: Game of the champions
        </a>
        
        <a href="/posts/wc-2018-day-25-game-of-champions.html" class="link-perma">
            <span>&#9679</span>
        </a>
    </h1>
    <div class="byline">
    <p class="date">July 16, 2018</p>
    <p class="author"><a href="/tags/sports.html">sports</a>, <a href="/tags/football.html">football</a>, <a href="/tags/world-cup.html">world-cup</a>, <a href="/tags/wc-2018.html">wc-2018</a></p>
</div>
<div class="bodycopy">
    <h2 id="the-final">The Final</h2>
<p><strong>Croatia 2 - France 4</strong></p>
<p>It could not have been more engaging and dramatic than what unfolded as one of the best World Cup finals of recent times. The game started with Croatians putting their heart and soul into the game. They created the first scare for France and were relentless in their pursuit to score early. It was first 15-20 minutes of a gripping game of Croatian attack &amp; pressure tactics. Unfortunately French got it past Croatian net for no credit of theirs. Croatian reply by the amazing Perisic was spellbinding. VAR came to the rescue of France as it’s been from their first game. I believe the resulting penalty was the turning point of the game.</p>
<p>The second half belonged to France. They showed their class with superb ball control and creative ball passing. Both Pogba’s and Mbappe’s goals were astounding. They are the signs of a team worthy of being a champion. Croatia, in the end, succumbed due to a bit of bad luck and a better opponent.</p>
<p>As the curtains dropped, I consider this edition of the World Cup to be one of the best of the modern era. It was full of honest surprises and impressive comebacks. But more than ever this World Cup was for those who dared to dream and deliberated on it by having fun rather than for those who either got complacent or were bored with the game.</p>
</div>

</article>
]]></summary>
</entry>
<entry>
    <title>WC 2018: Day 24: The consolation game</title>
    <link href="https://kaushikc.org/posts/wc-2018-day-24-consolation-game.html" />
    <id>https://kaushikc.org/posts/wc-2018-day-24-consolation-game.html</id>
    <published>2018-07-15T00:00:00Z</published>
    <updated>2018-07-15T00:00:00Z</updated>
    <summary type="html"><![CDATA[<article class="post">
    <h1>
        
        <a href="/posts/wc-2018-day-24-consolation-game.html">
            WC 2018: Day 24: The consolation game
        </a>
        
        <a href="/posts/wc-2018-day-24-consolation-game.html" class="link-perma">
            <span>&#9679</span>
        </a>
    </h1>
    <div class="byline">
    <p class="date">July 15, 2018</p>
    <p class="author"><a href="/tags/sports.html">sports</a>, <a href="/tags/football.html">football</a>, <a href="/tags/world-cup.html">world-cup</a>, <a href="/tags/wc-2018.html">wc-2018</a></p>
</div>
<div class="bodycopy">
    <h2 id="rd-4th-place-game">3rd &amp; 4th place game</h2>
<p><strong>England 0 - Belgium 2</strong></p>
<p>Belgians came back with their inventive &amp; creative gameplay. It was a treat to watch. England did not change much on playing boring football. It was fantastic watching Hazard &amp; De Bruyne sweating &amp; overcoming clueless English midfield &amp; defence. Hazard, in particular, created more chances than out-of-form Lukaku could handle. Belgium in a way deserved more than the 3rd place. And England needs to find fun in their game to start with.</p>
</div>

</article>
]]></summary>
</entry>
<entry>
    <title>WC 2018: Day 23: Croatian dream run</title>
    <link href="https://kaushikc.org/posts/wc-2018-day-23-croatian-dream-run.html" />
    <id>https://kaushikc.org/posts/wc-2018-day-23-croatian-dream-run.html</id>
    <published>2018-07-12T00:00:00Z</published>
    <updated>2018-07-12T00:00:00Z</updated>
    <summary type="html"><![CDATA[<article class="post">
    <h1>
        
        <a href="/posts/wc-2018-day-23-croatian-dream-run.html">
            WC 2018: Day 23: Croatian dream run
        </a>
        
        <a href="/posts/wc-2018-day-23-croatian-dream-run.html" class="link-perma">
            <span>&#9679</span>
        </a>
    </h1>
    <div class="byline">
    <p class="date">July 12, 2018</p>
    <p class="author"><a href="/tags/sports.html">sports</a>, <a href="/tags/football.html">football</a>, <a href="/tags/world-cup.html">world-cup</a>, <a href="/tags/wc-2018.html">wc-2018</a></p>
</div>
<div class="bodycopy">
    <h2 id="semifinal-2">Semifinal #2</h2>
<p><strong>England 1 - Croatia 2</strong></p>
<p>Ivan Sršen <a href="http://www.nybooks.com/daily/2018/07/11/world-cup-2018-croatias-conflict-resolution/">describing the mood as Croatian goalkeeper saved the decisive penalty against Russia in quarterfinal</a></p>
<blockquote>
<p>For a brief moment at least, to me and perhaps to all of us in the bar, it felt as though the war was <em>finally</em> over.</p>
</blockquote>
<p>Ivan also talks about the legacy of Croatian football and background of some current Croatian players like Modrić and Lovren. It highlights the significance of Croatian progress in this World Cup.</p>
<p>Football, the so-called beautiful game, only needs a pair of legs and pile of passion. That way it binds people from every stratum of society.</p>
<p>Last night the Croatian players showcased matured &amp; infallible football. It was a gripping game. Barring that superb 4th-minute free-kick, England had nothing to showcase in the whole 120 minutes. The Croatian players, like their coach, had a unique sense of calmness and deep focus. Which led them to dominate England in the whole match. England, as I have earlier mentioned as well, lacked both individual skills &amp; collective playmaking. Their early lead was never meant to stand against the pressing Croatian attack.</p>
<p>Croatia will face a much tougher &amp; skilful opposition in France in the final. They should work on improving their pass accuracy and man-tagging in the back, especially for the speedster Mbappe. But this nail-biting win over England should lift their spirits. They will attempt to cause the unthinkable for their country as they have done with their lives.</p>
</div>

</article>
]]></summary>
</entry>
<entry>
    <title>WC 2018: Day 22: Les bleus le progrès</title>
    <link href="https://kaushikc.org/posts/wc-2018-day-22-les-bleus-le-progres.html" />
    <id>https://kaushikc.org/posts/wc-2018-day-22-les-bleus-le-progres.html</id>
    <published>2018-07-11T00:00:00Z</published>
    <updated>2018-07-11T00:00:00Z</updated>
    <summary type="html"><![CDATA[<article class="post">
    <h1>
        
        <a href="/posts/wc-2018-day-22-les-bleus-le-progres.html">
            WC 2018: Day 22: Les bleus le progrès
        </a>
        
        <a href="/posts/wc-2018-day-22-les-bleus-le-progres.html" class="link-perma">
            <span>&#9679</span>
        </a>
    </h1>
    <div class="byline">
    <p class="date">July 11, 2018</p>
    <p class="author"><a href="/tags/sports.html">sports</a>, <a href="/tags/football.html">football</a>, <a href="/tags/world-cup.html">world-cup</a>, <a href="/tags/wc-2018.html">wc-2018</a></p>
</div>
<div class="bodycopy">
    <h2 id="semifinal-1">Semifinal #1</h2>
<p><strong>Belgium 0 - France 1</strong></p>
<p>Kylian Mbappé is a revolution. 4 mins in the match the way he ran from midfield to almost inside the Belgium goal post with the ball set the tone of the rest of the match. It would have been more misery for Belgium if his out of form teammate Giroud would have converted some wonderful passes. Belgium suffered from a lack of interest shown by their centre-forward Lukaku. He hardly kicked the ball in the overall match. Hazard was persistent &amp; De Bruyne tried his best to create chances from the flanks. Second half substitution of Mertens brought some much-needed energy to the team. But they suffered from a similar conundrum that Brazil had against them in the quarterfinal. France after scoring the crucial goal went to a full defensive mode. Which was kind of expected. It was a nice game &amp; I feel bad for the Belgs. This was the best team they could ever have. France on the, on the other hand, is clear if Mbappé maintains his pace &amp; check his cheekiness.</p>
</div>

</article>
]]></summary>
</entry>
<entry>
    <title>WC 2018: Day 21: The English March</title>
    <link href="https://kaushikc.org/posts/wc-2018-day-21-english-march.html" />
    <id>https://kaushikc.org/posts/wc-2018-day-21-english-march.html</id>
    <published>2018-07-08T00:00:00Z</published>
    <updated>2018-07-08T00:00:00Z</updated>
    <summary type="html"><![CDATA[<article class="post">
    <h1>
        
        <a href="/posts/wc-2018-day-21-english-march.html">
            WC 2018: Day 21: The English March
        </a>
        
        <a href="/posts/wc-2018-day-21-english-march.html" class="link-perma">
            <span>&#9679</span>
        </a>
    </h1>
    <div class="byline">
    <p class="date">July  8, 2018</p>
    <p class="author"><a href="/tags/sports.html">sports</a>, <a href="/tags/football.html">football</a>, <a href="/tags/world-cup.html">world-cup</a>, <a href="/tags/wc-2018.html">wc-2018</a></p>
</div>
<div class="bodycopy">
    <p>England has the best chance to go for the cup and hosts, unfortunately, had to stop at Quarters.</p>
<p><strong>Sweden 0 - England 2</strong></p>
<p>This English team is playing like a well-oiled machine. Lacking individual skills they rely more on each other &amp; set pieces to deliver. And they are doing that pretty well. They now have clear shot to the finals. And depending on who will stand on the other side if this team play sensibly they might do the unthinkable.</p>
<p><strong>Russia 2 (3) - Croatia 2 (4)</strong></p>
<p>It might be the loudest game of the tournament. Much of that roar was for host nation Russia. Russians did not disappoint at all. It was a game of blistering pace &amp; passion. Croatia, as I had previously pointed out, is playing with all their heart. They have not shown any sign of big tournament chill like many other underdogs. Which make their case against England in semis pretty interesting.</p>
</div>

</article>
]]></summary>
</entry>
<entry>
    <title>WC 2018: Day 20: South American exodus</title>
    <link href="https://kaushikc.org/posts/wc-2018-day20-south-american-exodus.html" />
    <id>https://kaushikc.org/posts/wc-2018-day20-south-american-exodus.html</id>
    <published>2018-07-07T00:00:00Z</published>
    <updated>2018-07-07T00:00:00Z</updated>
    <summary type="html"><![CDATA[<article class="post">
    <h1>
        
        <a href="/posts/wc-2018-day20-south-american-exodus.html">
            WC 2018: Day 20: South American exodus
        </a>
        
        <a href="/posts/wc-2018-day20-south-american-exodus.html" class="link-perma">
            <span>&#9679</span>
        </a>
    </h1>
    <div class="byline">
    <p class="date">July  7, 2018</p>
    <p class="author"><a href="/tags/sports.html">sports</a>, <a href="/tags/football.html">football</a>, <a href="/tags/world-cup.html">world-cup</a>, <a href="/tags/wc-2018.html">wc-2018</a></p>
</div>
<div class="bodycopy">
    <p>It will be again a European crown like last time.</p>
<p><strong>Uruguay 0 - France 2</strong></p>
<p>It was a game of tussle between Uruguayan desperation &amp; French persuasion. Without Cavani, the Uruguayan attack was like an already amputated man losing his last leg. Suarez tried his best to muster a number of chances. But none of his teammates had the vision or talent to work with them. France realised that &amp; made sure they don’t do anything silly on the back. French game had the same fluidity like last time. Mbappe showed some interesting skills both with his legs &amp; drama. However, I felt Uruguayans were not that bewildered by French defence. Which might be enough for Martinez’s jubilant men to easily triumph in the semis.</p>
<p><strong>Brazil 1 - Belgium 2</strong></p>
<p>This was the best match of the tournament so far for me (many consider Belgium’s last match with Japan to be the best). It was a great night of football where teams played to their best with a worthy winner in the end. Brazil’s painstaking efforts to penetrate Belgium defence was a treat to watch. Also quite heartbreaking. Belgium’s superb tactic to make De Bruyne play from the centre with Lukaku in the flanks split wide open Brazilian defence. Lukaku was unstoppable &amp; Hazard was critical. But I would say the real hero of the match was Courtois. His gravity-defying saves took the match away from Brazil.</p>
<p>Tite’s plan to not start with Firmino again might be a bad move. He along with Costa made quite an impression in the second half. However, I felt Brazil lacks a physically strong attacking player who could withstand the pushing &amp; shoving to rush inside a stubborn defence. Current talents like Neymar &amp; Coutinho are too feeble to make their way in &amp; hence spend most of the time strolling around the penalty circle. Brazil also missed some straightforward chances which are a criminal offence in the World Cup. Brazil did not disappoint like last time. I wish they progress further next time in Qatar.</p>
<p>In the meantime, I am betting on Belgium as champions.</p>
</div>

</article>
]]></summary>
</entry>
<entry>
    <title>WC 2018: Day 19: Boring drama</title>
    <link href="https://kaushikc.org/posts/wc-2018-day19-boring-drama.html" />
    <id>https://kaushikc.org/posts/wc-2018-day19-boring-drama.html</id>
    <published>2018-07-04T00:00:00Z</published>
    <updated>2018-07-04T00:00:00Z</updated>
    <summary type="html"><![CDATA[<article class="post">
    <h1>
        
        <a href="/posts/wc-2018-day19-boring-drama.html">
            WC 2018: Day 19: Boring drama
        </a>
        
        <a href="/posts/wc-2018-day19-boring-drama.html" class="link-perma">
            <span>&#9679</span>
        </a>
    </h1>
    <div class="byline">
    <p class="date">July  4, 2018</p>
    <p class="author"><a href="/tags/sports.html">sports</a>, <a href="/tags/football.html">football</a>, <a href="/tags/world-cup.html">world-cup</a>, <a href="/tags/wc-2018.html">wc-2018</a></p>
</div>
<div class="bodycopy">
    <h2 id="knockouts-day-3">Knockouts Day 3</h2>
<p>Sweeden &amp; Switzerland should be banned for playing the most boring game of the World Cup. And England narrowly missed <em>their exit</em>.</p>
<p><strong>Columbia 1 (3) - England 1 (4)</strong></p>
<p>Watching English players on the field is like watching a Twitch stream of someone playing the latest version of EA Sports’ FIFA. Their gameplay and style were so mechanical that it bored me to death. Columbians, on the other hand, showed exquisite legwork whenever they found time after doing those unnecessary pushing, shoving, and play-acting drama. The game was more of reality tv than a real sport. I pity the referee who should avoid travelling to South America anytime soon. England’s path till finals henceforth is easy (assuming Croatia don’t panic against Russia and then get beaten by the English luck). Also, their next game should be called off by sending Sweeden home for wasting the time of thousands of spectators with the most dreadful game of the tournament against Switzerland.</p>
</div>

</article>
]]></summary>
</entry>

</feed>
